
&НаСервере
Процедура СинхронизироватьСЦБНаСервере()
	
	Узел = ПланыОбмена.ОбменСФИллиалом.НайтиПоКоду("ЦБ");
		
	Соединение = Новый HTTPСоединение("192.168.0.6", 80);	
	Запрос = Новый HTTPЗапрос(Узел.АдресРесурса);

	Попытка
	
		Ответ = Соединение.ВызватьHTTPМетод("POST", Запрос);
		
	Исключение
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Не удалось выполнить соединение по причине: " + ОписаниеОшибки();
		Сообщение.Сообщить();	                                                           
		Возврат;
	КонецПопытки;
	
	Если Ответ.КодСостояния = 200 Тогда
		ДанныеОтвета = Ответ.ПолучитьТелоКакСтроку();
		
		Чтение = Новый ЧтениеXML;
		Чтение.УстановитьСтроку(ДанныеОтвета);
		
		ЧтениеСообщения = ПланыОбмена.СоздатьЧтениеСообщения();
		ЧтениеСообщения.НачатьЧтение(Чтение); 
		
		Пока ВозможностьЧтенияXML(Чтение) Цикл
			
			ОбъектЧтения = ПрочитатьXML(Чтение);
			ОбъектЧтения.Записать();
			
		КонецЦикла;                 
				
		ЧтениеСообщения.ЗакончитьЧтение();
		Чтение.Закрыть();
		
	Иначе		
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = СтрШаблон("Запрос не выполнен, код состояния %1, ответ сервера - '%2'", 
				Ответ.КодСостояния, Ответ.ПолучитьТелоКакСтроку(КодировкаТекста.UTF8));
		Сообщение.Сообщить();
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СинхронизироватьСЦБ(Команда)
	СинхронизироватьСЦБНаСервере();
КонецПроцедуры


&НаСервере
Функция JSONСтрока(ОбъектJSON)

	ЗаписьJSON = Новый ЗаписьJSON;
	ЗаписьJSON.УстановитьСтроку();
	ЗаписатьJSON(ЗаписьJSON, ОбъектJSON);
	Результат = ЗаписьJSON.Закрыть();
	
	Возврат Результат;

КонецФункции // JSONСтрока()
